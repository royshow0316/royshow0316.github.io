<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>
    八蛋的程式派對 | 側邊欄NavigationDrawer+多層TreeView之實現
  </title>
  <meta name="description" content="介紹 Navigation Drawer通常是從左邊邊緣拉出來的一個選單，是現在很常看到的UI元件。Google有提供此功能，這裡將使用Google提供的功能，來做到此效果，需用到DrawerLayout和NavigationView。DrawerLayout的功能是用來做從左到右拉出來的效果，Navigatio...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://royshow.github.io//android/2016/08/29/NavigationDrawerTreeView.html">
  <link rel="alternate" type="application/rss+xml" title="八蛋的程式派對" href="http://royshow.github.io//feed.xml">

  <style>
    @media screen and (min-width:600px) {
      body {
        width: 90%;
        margin-left: 5%;
      }
    }
    @media screen and (min-width:900px) {
      body {
        width: 80%;
        margin-left: 10%;
      }
    }
    @media screen and (min-width:1200px) {
      body {
        width: 70%;
        margin-left: 15%;
      }
    }
    @media screen and (min-width:1500px) {
      body {
        width: 60%;
        margin-left: 20%;
      }
    }
  </style>
</head>
  <div style="position:absolute;left:0"; style="background-color: #34352D">
    
  </div>
  <body style="background-image: url('/image/background.png'); background-repeat: repeat">
    <div align="center" style="background-color: #34352D; overflow: hidden">
      <script type="text/javascript" src="//js1.bloggerads.net/ShowBanner.aspx?blogid=20161103000005"></script>
    </div>
    <div style="background-color: #eeeeee;">
      <header class="site-header" role="banner">

  <div class="wrapper">

    <a class="site-title" href="/">
      <img src="/image/egg.png" height="24px" style="vertical-align: baseline" />
      八蛋的程式派對
    </a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
        
          
          <a class="page-link" href="/">文章列表</a>
          
        
          
        
          
          <a class="page-link" href="/about/">關於</a>
          
        
          
          <a class="page-link" href="/categories/">類別</a>
          
        
      </div>
    </nav>

  </div>

</header>
      <main class="page-content" aria-label="Content">
          <div class="wrapper">
            <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">側邊欄NavigationDrawer+多層TreeView之實現</h1>
    <p class="post-meta">
      <time datetime="2016-08-29T13:49:31+08:00" itemprop="datePublished">
        Aug 29, 2016
      </time>
      &nbsp;
      <span class="categories">類別:
        
        <a href="/categories/#Android" title="Android">Android</a>&nbsp;
        </span>
      
      &nbsp;
      <span class="tags">標籤:
        </span>
      
    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h2 id="section">介紹</h2>
<p>Navigation Drawer通常是從左邊邊緣拉出來的一個選單，是現在很常看到的UI元件。Google有提供此功能，這裡將使用Google提供的功能，來做到此效果，需用到DrawerLayout和NavigationView。DrawerLayout的功能是用來做從左到右拉出來的效果，NavigationView則是用來在拉出來的畫面上顯示資料和選單。
TreeView是一種在Windows常見的多層清單表示方式，而在Android中只提供了ExpandableListView，最多只支援到兩層清單的表示，所以如果想實現三層或多層的清單，就需要我們自己客製了，TreeView已有人做出，我將他改成自己需要用的字合併到Navigation Drawer，達到實現側邊欄裡還要能顯示多層清單的功能。</p>

<h2 id="navigationdrawer-style">NavigationDrawer-設定Style</h2>
<p>開啟AndroidManifest.xml確認使用android:theme為@style/AppTheme。再開啟styles.xml，將AppTheme的parent改為Theme.AppCompat.Light.NoActionBar，並加入以下items。</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;style</span> <span class="na">name=</span><span class="s">"AppTheme"</span> <span class="na">parent=</span><span class="s">"Theme.AppCompat.Light.NoActionBar"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- Customize your theme here. --&gt;</span>
        <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"colorPrimary"</span><span class="nt">&gt;</span>#212121<span class="nt">&lt;/item&gt;</span>
        <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"colorPrimaryDark"</span><span class="nt">&gt;</span>#187817<span class="nt">&lt;/item&gt;</span>
        <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"windowActionBar"</span><span class="nt">&gt;</span>false<span class="nt">&lt;/item&gt;</span>
        <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"windowNoTitle"</span><span class="nt">&gt;</span>true<span class="nt">&lt;/item&gt;</span>
        <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"android:windowFullscreen"</span><span class="nt">&gt;</span>true<span class="nt">&lt;/item&gt;</span>
        <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"android:windowActionModeOverlay"</span><span class="nt">&gt;</span>true<span class="nt">&lt;/item&gt;</span>
        <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"android:windowDrawsSystemBarBackgrounds"</span><span class="nt">&gt;</span>true<span class="nt">&lt;/item&gt;</span>
        <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"android:statusBarColor"</span><span class="nt">&gt;</span>@android:color/transparent<span class="nt">&lt;/item&gt;</span>
<span class="nt">&lt;/style&gt;</span></code></pre></figure>

<h2 id="navigationdrawer-layout">NavigationDrawer-設定layout</h2>
<p>再來設定layout，DrawerLayout主要是一個跟畫面(root view)，裡面只能包含兩個view，一個是主要內容的view，另一個是拉出來的選單view，這裡以LinearLayout和TextView來作為主要內容。NavigationView分上下兩部分，上面的是headerLayout，下面的是menu，通常會設置res/menu，然後再載入。activity_main如下。</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;android.support.v4.widget.DrawerLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">xmlns:app=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span>
    <span class="na">android:id=</span><span class="s">"@+id/drawerLayout"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
    <span class="na">android:fitsSystemWindows=</span><span class="s">"true"</span>
    <span class="na">tools:context=</span><span class="s">"com.ietm.navigationdrawertreeview.MainActivity"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;LinearLayout</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
        <span class="na">android:orientation=</span><span class="s">"vertical"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;android.support.v7.widget.Toolbar</span>
            <span class="na">android:id=</span><span class="s">"@+id/toolbar"</span>
            <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
            <span class="na">android:layout_height=</span><span class="s">"@dimen/abc_action_bar_default_height_material"</span>
            <span class="na">android:background=</span><span class="s">"?attr/colorPrimary"</span>
            <span class="na">android:minHeight=</span><span class="s">"?attr/actionBarSize"</span>
            <span class="na">android:theme=</span><span class="s">"@style/ThemeOverlay.AppCompat.Dark.ActionBar"</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;TextView</span>
            <span class="na">android:id=</span><span class="s">"@+id/contentView"</span>
            <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
            <span class="na">android:text=</span><span class="s">"Hello World"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/LinearLayout&gt;</span>

    <span class="nt">&lt;android.support.design.widget.NavigationView</span>
        <span class="na">android:id=</span><span class="s">"@+id/navigationView"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_gravity=</span><span class="s">"start"</span>
        <span class="na">app:headerLayout=</span><span class="s">"@layout/drawer_header"</span>
        <span class="na">app:menu=</span><span class="s">"@menu/drawer"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/android.support.v4.widget.DrawerLayout&gt;</span></code></pre></figure>

<p>drawer_header，可自行加入圖片或個人頭像，我只用TextView加上背景色。</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;RelativeLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"190dp"</span>
    <span class="na">android:background=</span><span class="s">"#FF0000"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;TextView</span>
        <span class="na">android:id=</span><span class="s">"@+id/name"</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_marginLeft=</span><span class="s">"24dp"</span>
        <span class="na">android:layout_marginStart=</span><span class="s">"24dp"</span>
        <span class="na">android:layout_alignParentBottom=</span><span class="s">"true"</span>
        <span class="na">android:text=</span><span class="s">"Royshow"</span>
        <span class="na">android:textSize=</span><span class="s">"18sp"</span>
        <span class="na">android:textColor=</span><span class="s">"#fff"</span>
        <span class="na">android:textStyle=</span><span class="s">"bold"</span>
        <span class="na">android:paddingBottom=</span><span class="s">"8dp"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/RelativeLayout&gt;</span></code></pre></figure>

<h2 id="navigationdrawer-menu">NavigationDrawer-設定menu</h2>
<p>將menu，設置在res/menu/drawer，如下。</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;menu</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;group</span> <span class="na">android:checkableBehavior=</span><span class="s">"single"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;item</span>
            <span class="na">android:id=</span><span class="s">"@+id/navigationItem1"</span>
            <span class="na">android:checked=</span><span class="s">"true"</span>
            <span class="na">android:icon=</span><span class="s">"@drawable/ic_launcher"</span>
            <span class="na">android:title=</span><span class="s">"Navigation Items 1"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;item</span>
            <span class="na">android:id=</span><span class="s">"@+id/navigationItem2"</span>
            <span class="na">android:icon=</span><span class="s">"@drawable/ic_launcher"</span>
            <span class="na">android:title=</span><span class="s">"Navigation Items 2"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;item</span>
            <span class="na">android:id=</span><span class="s">"@+id/navigationItem3"</span>
            <span class="na">android:icon=</span><span class="s">"@drawable/ic_launcher"</span>
            <span class="na">android:title=</span><span class="s">"Navigation Items 3"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/group&gt;</span>
<span class="nt">&lt;/menu&gt;</span></code></pre></figure>

<p>在onCreate中加入以下程式，</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">Toolbar</span> <span class="n">toolbar</span> <span class="o">=</span> <span class="o">(</span><span class="n">Toolbar</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">toolbar</span><span class="o">);</span>
<span class="n">setSupportActionBar</span><span class="o">(</span><span class="n">toolbar</span><span class="o">);</span>

<span class="n">contentView</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">content_view</span><span class="o">);</span>
<span class="n">drawerLayout</span> <span class="o">=</span> <span class="o">(</span><span class="n">DrawerLayout</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">drawer_layout</span><span class="o">);</span>
<span class="n">NavigationView</span> <span class="n">view</span> <span class="o">=</span> <span class="o">(</span><span class="n">NavigationView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">navigation_view</span><span class="o">);</span>
<span class="n">view</span><span class="o">.</span><span class="na">setNavigationItemSelectedListener</span><span class="o">(</span><span class="k">new</span> <span class="n">NavigationView</span><span class="o">.</span><span class="na">OnNavigationItemSelectedListener</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onNavigationItemSelected</span><span class="o">(</span><span class="n">MenuItem</span> <span class="n">menuItem</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="n">menuItem</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()</span> <span class="o">+</span> <span class="s">" pressed"</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
        <span class="n">contentView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">menuItem</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>

        <span class="n">menuItem</span><span class="o">.</span><span class="na">setChecked</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">drawerLayout</span><span class="o">.</span><span class="na">closeDrawers</span><span class="o">();</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">});</span></code></pre></figure>

<p>將ToolBar改成ActionBar。並為Navigation加上OnNavigationItemSelectedListener，這樣按menuItem的話，就會顯示toast。
執行試一試，drawerLayout可以拉出來。</p>

<p><img src="/image/NavigationDrawerTreeView/NavigationDrawer.png" alt="NavigationDrawerImg" class="img-responsive" height="500px" width="300px" /></p>

<h2 id="navigationdrawer-">NavigationDrawer-加上三圖示</h2>
<p>這個要利用actionBarDrawerToggle來做了，到onCreat()加上actionBarDrawerToggle，如下。</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">ActionBarDrawerToggle</span> <span class="n">actionBarDrawerToggle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ActionBarDrawerToggle</span><span class="o">(</span> <span class="k">this</span><span class="o">,</span> <span class="n">drawerLayout</span><span class="o">,</span> <span class="n">toolbar</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">openDrawer</span> <span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">closeDrawer</span><span class="o">){</span>
           <span class="nd">@Override</span>
           <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDrawerClosed</span><span class="o">(</span><span class="n">View</span> <span class="n">drawerView</span><span class="o">)</span> <span class="o">{</span>
                <span class="kd">super</span> <span class="o">.</span><span class="na">onDrawerClosed</span><span class="o">(</span><span class="n">drawerView</span><span class="o">);</span>
           <span class="o">}</span>

           <span class="nd">@Override</span>
           <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDrawerOpened</span><span class="o">(</span><span class="n">View</span> <span class="n">drawerView</span><span class="o">)</span> <span class="o">{</span>
                <span class="kd">super</span> <span class="o">.</span><span class="na">onDrawerOpened</span><span class="o">(</span><span class="n">drawerView</span><span class="o">);</span>
           <span class="o">}</span>
      <span class="o">};</span>

      <span class="n">drawerLayout</span><span class="o">.</span><span class="na">setDrawerListener</span><span class="o">(</span><span class="n">actionBarDrawerToggle</span><span class="o">);</span>
      <span class="n">actionBarDrawerToggle</span><span class="o">.</span><span class="na">syncState</span><span class="o">();</span></code></pre></figure>

<p>這樣三就出來了。</p>

<p><img src="/image/NavigationDrawerTreeView/NavigationDrawerMenuIcon.png" alt="NavigationDrawerMenuIconImg" class="img-responsive" height="500px" width="300px" /></p>

<h2 id="treeview-elementjava">TreeView-Element.java</h2>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Element</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">contentText</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">level</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">parendId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">hasChildren</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">isExpanded</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">NO_PARENT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">TOP_LEVEL</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Element</span><span class="o">(</span><span class="n">String</span> <span class="n">contentText</span><span class="o">,</span> <span class="kt">int</span> <span class="n">level</span><span class="o">,</span> <span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="kt">int</span> <span class="n">parendId</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">hasChildren</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isExpanded</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">contentText</span> <span class="o">=</span> <span class="n">contentText</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">level</span> <span class="o">=</span> <span class="n">level</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">parendId</span> <span class="o">=</span> <span class="n">parendId</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">hasChildren</span> <span class="o">=</span> <span class="n">hasChildren</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">isExpanded</span> <span class="o">=</span> <span class="n">isExpanded</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isExpanded</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">isExpanded</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpanded</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">isExpanded</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">isExpanded</span> <span class="o">=</span> <span class="n">isExpanded</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getContentText</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">contentText</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContentText</span><span class="o">(</span><span class="n">String</span> <span class="n">contentText</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">contentText</span> <span class="o">=</span> <span class="n">contentText</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getLevel</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">level</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLevel</span><span class="o">(</span><span class="kt">int</span> <span class="n">level</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">level</span> <span class="o">=</span> <span class="n">level</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getParendId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">parendId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setParendId</span><span class="o">(</span><span class="kt">int</span> <span class="n">parendId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">parendId</span> <span class="o">=</span> <span class="n">parendId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isHasChildren</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">hasChildren</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHasChildren</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">hasChildren</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">hasChildren</span> <span class="o">=</span> <span class="n">hasChildren</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h2 id="treeview-treeviewadapterjava">TreeView-TreeViewAdapter.java</h2>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TreeViewAdapter</span> <span class="kd">extends</span> <span class="n">BaseAdapter</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Element</span><span class="o">&gt;</span> <span class="n">elementsData</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Element</span><span class="o">&gt;</span> <span class="n">elements</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">indentionBase</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">TreeViewAdapter</span><span class="o">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Element</span><span class="o">&gt;</span> <span class="n">elements</span><span class="o">,</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Element</span><span class="o">&gt;</span> <span class="n">elementsData</span><span class="o">,</span> <span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">elements</span> <span class="o">=</span> <span class="n">elements</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">elementsData</span> <span class="o">=</span> <span class="n">elementsData</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">inflater</span> <span class="o">=</span> <span class="n">inflater</span><span class="o">;</span>
        <span class="n">indentionBase</span> <span class="o">=</span> <span class="mi">50</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Element</span><span class="o">&gt;</span> <span class="nf">getElements</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">elements</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Element</span><span class="o">&gt;</span> <span class="nf">getElementsData</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">elementsData</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">elements</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getItem</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">elements</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getItemId</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">position</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">View</span> <span class="nf">getView</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="n">View</span> <span class="n">convertView</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">parent</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ViewHolder</span> <span class="n">holder</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">convertView</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">holder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ViewHolder</span><span class="o">();</span>
            <span class="n">convertView</span> <span class="o">=</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">treeview_item</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="n">holder</span><span class="o">.</span><span class="na">disclosureImg</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span> <span class="n">convertView</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">disclosureImg</span><span class="o">);</span>
            <span class="n">holder</span><span class="o">.</span><span class="na">contentText</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">convertView</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">contentText</span><span class="o">);</span>
            <span class="n">convertView</span><span class="o">.</span><span class="na">setTag</span><span class="o">(</span><span class="n">holder</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">holder</span> <span class="o">=</span> <span class="o">(</span><span class="n">ViewHolder</span><span class="o">)</span> <span class="n">convertView</span><span class="o">.</span><span class="na">getTag</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">Element</span> <span class="n">element</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">level</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="na">getLevel</span><span class="o">();</span>
        <span class="n">holder</span><span class="o">.</span><span class="na">disclosureImg</span><span class="o">.</span><span class="na">setPadding</span><span class="o">(</span>
                <span class="n">indentionBase</span> <span class="o">*</span> <span class="o">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">0</span><span class="o">),</span>
                <span class="n">holder</span><span class="o">.</span><span class="na">disclosureImg</span><span class="o">.</span><span class="na">getPaddingTop</span><span class="o">(),</span>
                <span class="n">holder</span><span class="o">.</span><span class="na">disclosureImg</span><span class="o">.</span><span class="na">getPaddingRight</span><span class="o">(),</span>
                <span class="n">holder</span><span class="o">.</span><span class="na">disclosureImg</span><span class="o">.</span><span class="na">getPaddingBottom</span><span class="o">());</span>
        <span class="n">holder</span><span class="o">.</span><span class="na">contentText</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">getContentText</span><span class="o">());</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">isHasChildren</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">element</span><span class="o">.</span><span class="na">isExpanded</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">holder</span><span class="o">.</span><span class="na">disclosureImg</span><span class="o">.</span><span class="na">setImageResource</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">close</span><span class="o">);</span>
            <span class="c1">//這裡要主動設置一下icon可見，因為convertView重用了,"設置了不可見"的view</span>
            <span class="n">holder</span><span class="o">.</span><span class="na">disclosureImg</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">isHasChildren</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">element</span><span class="o">.</span><span class="na">isExpanded</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">holder</span><span class="o">.</span><span class="na">disclosureImg</span><span class="o">.</span><span class="na">setImageResource</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">open</span><span class="o">);</span>
            <span class="n">holder</span><span class="o">.</span><span class="na">disclosureImg</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(!</span><span class="n">element</span><span class="o">.</span><span class="na">isHasChildren</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">holder</span><span class="o">.</span><span class="na">disclosureImg</span><span class="o">.</span><span class="na">setImageResource</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">close</span><span class="o">);</span>
            <span class="n">holder</span><span class="o">.</span><span class="na">disclosureImg</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">INVISIBLE</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">convertView</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ViewHolder</span><span class="o">{</span>
        <span class="n">ImageView</span> <span class="n">disclosureImg</span><span class="o">;</span>
        <span class="n">TextView</span> <span class="n">contentText</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h2 id="treeview-treeviewitemclicklistenerjava">TreeView-TreeViewItemClickListener.java</h2>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TreeViewItemClickListener</span> <span class="kd">implements</span> <span class="n">AdapterView</span><span class="o">.</span><span class="na">OnItemClickListener</span><span class="o">{</span>

    <span class="kd">private</span> <span class="n">TreeViewAdapter</span> <span class="n">treeViewAdapter</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">TreeViewItemClickListener</span><span class="o">(</span><span class="n">TreeViewAdapter</span> <span class="n">treeViewAdapter</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">treeViewAdapter</span> <span class="o">=</span> <span class="n">treeViewAdapter</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onItemClick</span><span class="o">(</span><span class="n">AdapterView</span><span class="o">&lt;?&gt;</span> <span class="n">parent</span><span class="o">,</span> <span class="n">View</span> <span class="n">view</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Element</span> <span class="n">element</span> <span class="o">=</span> <span class="o">(</span><span class="n">Element</span><span class="o">)</span> <span class="n">treeViewAdapter</span><span class="o">.</span><span class="na">getItem</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>

        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Element</span><span class="o">&gt;</span> <span class="n">elements</span> <span class="o">=</span> <span class="n">treeViewAdapter</span><span class="o">.</span><span class="na">getElements</span><span class="o">();</span>

        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Element</span><span class="o">&gt;</span> <span class="n">elementsData</span> <span class="o">=</span> <span class="n">treeViewAdapter</span><span class="o">.</span><span class="na">getElementsData</span><span class="o">();</span>

        <span class="k">if</span> <span class="o">(!</span><span class="n">element</span><span class="o">.</span><span class="na">isHasChildren</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">isExpanded</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">element</span><span class="o">.</span><span class="na">setExpanded</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

            <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Element</span><span class="o">&gt;</span> <span class="n">elementsToDel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Element</span><span class="o">&gt;();</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">elements</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">getLevel</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="n">elements</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getLevel</span><span class="o">())</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="n">elementsToDel</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">elements</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
            <span class="o">}</span>
            <span class="n">elements</span><span class="o">.</span><span class="na">removeAll</span><span class="o">(</span><span class="n">elementsToDel</span><span class="o">);</span>
            <span class="n">treeViewAdapter</span><span class="o">.</span><span class="na">notifyDataSetChanged</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">element</span><span class="o">.</span><span class="na">setExpanded</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

            <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">Element</span> <span class="n">e</span> <span class="o">:</span> <span class="n">elementsData</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getParendId</span><span class="o">()</span> <span class="o">==</span> <span class="n">element</span><span class="o">.</span><span class="na">getId</span><span class="o">())</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">setExpanded</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
                    <span class="n">elements</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">position</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
                    <span class="n">i</span> <span class="o">++;</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="n">treeViewAdapter</span><span class="o">.</span><span class="na">notifyDataSetChanged</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h2 id="treeview-treeviewitemxml">TreeView-treeview_item.xml</h2>
<p>這裡主要是自己製作多層的清單項目，使用ImageView和TextView，如下。</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;RelativeLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">android:orientation=</span><span class="s">"vertical"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;ImageView</span>
        <span class="na">android:id=</span><span class="s">"@+id/disclosureImg"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_centerVertical=</span><span class="s">"true"</span>
        <span class="na">android:layout_alignParentLeft=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;TextView</span>
        <span class="na">android:id=</span><span class="s">"@+id/contentText"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_centerVertical=</span><span class="s">"true"</span>
        <span class="na">android:layout_toRightOf=</span><span class="s">"@id/disclosureImg"</span>
        <span class="na">android:textSize=</span><span class="s">"20dp"</span>
        <span class="na">android:textColor=</span><span class="s">"@color/white"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/RelativeLayout&gt;</span></code></pre></figure>

<h2 id="activitymainxml">修改activity_main.xml</h2>
<p>在NavigationView裡，加入一個LinearLayout和ListView，如下。</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;android.support.design.widget.NavigationView</span>
        <span class="na">android:id=</span><span class="s">"@+id/navigationView"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_gravity=</span><span class="s">"start"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;LinearLayout</span>
            <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
            <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
            <span class="na">android:orientation=</span><span class="s">"vertical"</span>
            <span class="na">android:background=</span><span class="s">"@color/black"</span><span class="nt">&gt;</span>

            <span class="nt">&lt;ListView</span>
                <span class="na">android:id=</span><span class="s">"@+id/treeListView"</span>
                <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
                <span class="na">android:layout_height=</span><span class="s">"match_parent"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/LinearLayout&gt;</span>

    <span class="nt">&lt;/android.support.design.widget.NavigationView&gt;</span></code></pre></figure>

<h2 id="mainactivityjava">MainActivity.java</h2>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">NAV_ITEM_ID</span> <span class="o">=</span> <span class="s">"nav_index"</span><span class="o">;</span>

    <span class="n">DrawerLayout</span> <span class="n">drawerLayout</span><span class="o">;</span>
    <span class="n">TextView</span> <span class="n">contentView</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">navItemId</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Element</span><span class="o">&gt;</span> <span class="n">elements</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Element</span><span class="o">&gt;</span> <span class="n">elementsData</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

        <span class="n">LayoutInflater</span> <span class="n">inflater</span> <span class="o">=</span> <span class="o">(</span><span class="n">LayoutInflater</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">LAYOUT_INFLATER_SERVICE</span><span class="o">);</span>

        <span class="n">init</span><span class="o">();</span>

        <span class="n">ListView</span> <span class="n">treeview</span> <span class="o">=</span> <span class="o">(</span><span class="n">ListView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">treeListView</span><span class="o">);</span>
        <span class="n">TreeViewAdapter</span> <span class="n">treeViewAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeViewAdapter</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="n">elementsData</span><span class="o">,</span> <span class="n">inflater</span><span class="o">);</span>

        <span class="n">TreeViewItemClickListener</span> <span class="n">treeViewItemClickListener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeViewItemClickListener</span><span class="o">(</span><span class="n">treeViewAdapter</span><span class="o">);</span>
        <span class="n">treeview</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">treeViewAdapter</span><span class="o">);</span>
        <span class="n">treeview</span><span class="o">.</span><span class="na">setOnItemClickListener</span><span class="o">(</span><span class="n">treeViewItemClickListener</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">Toolbar</span> <span class="n">toolbar</span> <span class="o">=</span> <span class="o">(</span><span class="n">Toolbar</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">toolbar</span><span class="o">);</span>
        <span class="n">setSupportActionBar</span><span class="o">(</span><span class="n">toolbar</span><span class="o">);</span>

        <span class="n">contentView</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">contentView</span><span class="o">);</span>
        <span class="n">drawerLayout</span> <span class="o">=</span> <span class="o">(</span><span class="n">DrawerLayout</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">drawerLayout</span><span class="o">);</span>
        <span class="n">NavigationView</span> <span class="n">view</span> <span class="o">=</span> <span class="o">(</span><span class="n">NavigationView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">navigationView</span><span class="o">);</span>
        <span class="n">view</span><span class="o">.</span><span class="na">setNavigationItemSelectedListener</span><span class="o">(</span><span class="k">new</span> <span class="n">NavigationView</span><span class="o">.</span><span class="na">OnNavigationItemSelectedListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onNavigationItemSelected</span><span class="o">(</span><span class="n">MenuItem</span> <span class="n">menuItem</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="n">menuItem</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()</span> <span class="o">+</span> <span class="s">" pressed"</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                <span class="n">navigateTo</span><span class="o">(</span><span class="n">menuItem</span><span class="o">);</span>

                <span class="n">drawerLayout</span><span class="o">.</span><span class="na">closeDrawers</span><span class="o">();</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="n">ActionBarDrawerToggle</span> <span class="n">actionBarDrawerToggle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ActionBarDrawerToggle</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">drawerLayout</span><span class="o">,</span> <span class="n">toolbar</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">openDrawer</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">closeDrawer</span><span class="o">)</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDrawerClosed</span><span class="o">(</span><span class="n">View</span> <span class="n">drawerView</span><span class="o">)</span> <span class="o">{</span>
                <span class="kd">super</span><span class="o">.</span><span class="na">onDrawerClosed</span><span class="o">(</span><span class="n">drawerView</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDrawerOpened</span><span class="o">(</span><span class="n">View</span> <span class="n">drawerView</span><span class="o">)</span> <span class="o">{</span>
                <span class="kd">super</span><span class="o">.</span><span class="na">onDrawerOpened</span><span class="o">(</span><span class="n">drawerView</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">};</span>
        <span class="n">drawerLayout</span><span class="o">.</span><span class="na">setDrawerListener</span><span class="o">(</span><span class="n">actionBarDrawerToggle</span><span class="o">);</span>
        <span class="n">actionBarDrawerToggle</span><span class="o">.</span><span class="na">syncState</span><span class="o">();</span>

<span class="c1">//        if(null != savedInstanceState){</span>
<span class="c1">//            navItemId = savedInstanceState.getInt(NAV_ITEM_ID, R.id.navigationItem1);</span>
<span class="c1">//        }</span>
<span class="c1">//        else{</span>
<span class="c1">//            navItemId = R.id.navigationItem1;</span>
<span class="c1">//        }</span>
<span class="c1">//        navigateTo(view.getMenu().findItem(navItemId));</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onCreateOptionsMenu</span><span class="o">(</span><span class="n">Menu</span> <span class="n">menu</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Inflate the menu; this adds items to the action bar if it is present.</span>
        <span class="n">getMenuInflater</span><span class="o">().</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">menu</span><span class="o">.</span><span class="na">menu_main</span><span class="o">,</span> <span class="n">menu</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onOptionsItemSelected</span><span class="o">(</span><span class="n">MenuItem</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Handle action bar item clicks here. The action bar will</span>
        <span class="c1">// automatically handle clicks on the Home/Up button, so long</span>
        <span class="c1">// as you specify a parent activity in AndroidManifest.xml.</span>
        <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">();</span>

        <span class="c1">//noinspection SimplifiableIfStatement</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">action_settings</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onOptionsItemSelected</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">navigateTo</span><span class="o">(</span><span class="n">MenuItem</span> <span class="n">menuItem</span><span class="o">){</span>
        <span class="n">contentView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">menuItem</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>

        <span class="n">navItemId</span> <span class="o">=</span> <span class="n">menuItem</span><span class="o">.</span><span class="na">getItemId</span><span class="o">();</span>
        <span class="n">menuItem</span><span class="o">.</span><span class="na">setChecked</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Element</span><span class="o">&gt;</span> <span class="o">();</span>
        <span class="n">elementsData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Element</span><span class="o">&gt;</span> <span class="o">();</span>

        <span class="n">Element</span> <span class="n">element1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Element</span><span class="o">(</span><span class="s">"模組A第一層"</span><span class="o">,</span> <span class="n">Element</span><span class="o">.</span><span class="na">TOP_LEVEL</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">Element</span><span class="o">.</span><span class="na">NO_PARENT</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>

        <span class="n">Element</span> <span class="n">element2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Element</span><span class="o">(</span><span class="s">"模組A第二層"</span><span class="o">,</span> <span class="n">Element</span><span class="o">.</span><span class="na">TOP_LEVEL</span> <span class="o">+</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="n">element1</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="n">Element</span> <span class="n">element3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Element</span><span class="o">(</span><span class="s">"模組A第三層"</span><span class="o">,</span> <span class="n">Element</span><span class="o">.</span><span class="na">TOP_LEVEL</span> <span class="o">+</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="n">element2</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="n">Element</span> <span class="n">element4</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Element</span><span class="o">(</span><span class="s">"模組A第四層"</span><span class="o">,</span> <span class="n">Element</span><span class="o">.</span><span class="na">TOP_LEVEL</span> <span class="o">+</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="n">element3</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>

        <span class="n">Element</span> <span class="n">element5</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Element</span><span class="o">(</span><span class="s">"模組A第二層-2"</span><span class="o">,</span> <span class="n">Element</span><span class="o">.</span><span class="na">TOP_LEVEL</span> <span class="o">+</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="n">element1</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="n">Element</span> <span class="n">element6</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Element</span><span class="o">(</span><span class="s">"模組A第三層-2"</span><span class="o">,</span> <span class="n">Element</span><span class="o">.</span><span class="na">TOP_LEVEL</span> <span class="o">+</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="n">element5</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="n">Element</span> <span class="n">element7</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Element</span><span class="o">(</span><span class="s">"模組A第四層-2"</span><span class="o">,</span> <span class="n">Element</span><span class="o">.</span><span class="na">TOP_LEVEL</span> <span class="o">+</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="n">element6</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>

        <span class="n">Element</span> <span class="n">element8</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Element</span><span class="o">(</span><span class="s">"模組A第二層-3"</span><span class="o">,</span> <span class="n">Element</span><span class="o">.</span><span class="na">TOP_LEVEL</span> <span class="o">+</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="n">element1</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>

        <span class="n">Element</span> <span class="n">element9</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Element</span><span class="o">(</span><span class="s">"模組B第一層"</span><span class="o">,</span> <span class="n">Element</span><span class="o">.</span><span class="na">TOP_LEVEL</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="n">Element</span><span class="o">.</span><span class="na">NO_PARENT</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="n">Element</span> <span class="n">element10</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Element</span><span class="o">(</span><span class="s">"模組B第二層"</span><span class="o">,</span> <span class="n">Element</span><span class="o">.</span><span class="na">TOP_LEVEL</span> <span class="o">+</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="n">element9</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="n">Element</span> <span class="n">element11</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Element</span><span class="o">(</span><span class="s">"模組B第三層"</span><span class="o">,</span> <span class="n">Element</span><span class="o">.</span><span class="na">TOP_LEVEL</span> <span class="o">+</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="n">element10</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="n">Element</span> <span class="n">element12</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Element</span><span class="o">(</span><span class="s">"模組B第四層"</span><span class="o">,</span> <span class="n">Element</span><span class="o">.</span><span class="na">TOP_LEVEL</span> <span class="o">+</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="n">element11</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="n">Element</span> <span class="n">element13</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Element</span><span class="o">(</span><span class="s">"模組B第五層"</span><span class="o">,</span> <span class="n">Element</span><span class="o">.</span><span class="na">TOP_LEVEL</span> <span class="o">+</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="n">element12</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>

        <span class="n">elements</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element1</span><span class="o">);</span>
        <span class="n">elements</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element9</span><span class="o">);</span>

        <span class="n">elementsData</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element1</span><span class="o">);</span>
        <span class="n">elementsData</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element2</span><span class="o">);</span>
        <span class="n">elementsData</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element3</span><span class="o">);</span>
        <span class="n">elementsData</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element4</span><span class="o">);</span>
        <span class="n">elementsData</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element5</span><span class="o">);</span>
        <span class="n">elementsData</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element6</span><span class="o">);</span>
        <span class="n">elementsData</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element7</span><span class="o">);</span>
        <span class="n">elementsData</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element8</span><span class="o">);</span>
        <span class="n">elementsData</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element9</span><span class="o">);</span>
        <span class="n">elementsData</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element10</span><span class="o">);</span>
        <span class="n">elementsData</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element11</span><span class="o">);</span>
        <span class="n">elementsData</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element12</span><span class="o">);</span>
        <span class="n">elementsData</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element13</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onSaveInstanceState</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">outState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onSaveInstanceState</span><span class="o">(</span><span class="n">outState</span><span class="o">);</span>
        <span class="n">outState</span><span class="o">.</span><span class="na">putInt</span><span class="o">(</span><span class="n">NAV_ITEM_ID</span><span class="o">,</span> <span class="n">navItemId</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p><a href="https://github.com/royshow0316/NavigationDrawerTreeView" target="_blank">程式碼已放上Github</a></p>


  </div>

</article>

          </div>
      </main>
      <footer class="site-footer">

  <div class="wrapper">

    <!--<h2 class="footer-heading">八蛋的程式派對</h2>-->
    <p></p>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1" align="center">
        <ul class="contact-list">
          <!-- <li>八蛋的程式派對</li> -->
          <li>聯絡我</li>
          <li><a href="mailto:royshow0316@gmail.com">royshow0316@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2" align="center">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/royshow0316"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">royshow0316</span></a>

          </li>
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3" align="center">
        <!-- <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
</p> -->
        <p>Powered by <a href="https://jekyllrb.com/" target="_blank">Jekyll</a>
        ,  Hosted by <a href="https://github.com/" target="_blank">Github</a>
        </p>
      </div>
    </div>

  </div>

</footer>
    </div>
  </body>

</html>
